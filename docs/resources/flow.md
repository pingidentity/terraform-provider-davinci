---
page_title: "davinci_flow Resource - terraform-provider-davinci"
subcategory: "Flow"
description: |-
  Resource to import and manage a DaVinci flow in an environment.  Connection and Subflow references in the JSON export can be overridden with ones managed by Terraform, see the examples and schema below for details.
---

# davinci_flow (Resource)

Resource to import and manage a DaVinci flow in an environment.  Connection and Subflow references in the JSON export can be overridden with ones managed by Terraform, see the examples and schema below for details.

!> Only flows that include variable values are supported. Flows that have been exported from a source system with the "Include Variable Values" admin console tickbox unchecked will not be imported correctly.

!> When flow, flow instance or company variables are embedded in the `flow_json`, only the `context`, `type` and `name` of the variables are managed by this resource.  To manage the mutability, value, description, minimum and maximum values of an imported variable, the `davinci_variable` resource must be used.

~> When using "company" or "flow instance" variables, it is recommended to define these variables using the `davinci_variable` resource before the flows that depend on them. This is shown in the example using the `depends_on` meta argument.

~> When using "flow" variables, it is recommended to declare these variables using the `davinci_variable` resource after the flows that depends on them have been imported, as shown in the example.

## Example Usage

```terraform
resource "davinci_variable" "my_awesome_region_variable" {
  environment_id = var.environment_id

  context = "company"

  name        = "region"
  description = "a company variable referenced in the main flow"
  value       = "northamerica"
  type        = "string"
}

resource "davinci_variable" "my_awesome_language_variable" {
  environment_id = var.environment_id

  context = "flowInstance"

  name        = "language"
  description = "a flow instance variable referenced in the sub flow and the main flow"
  value       = "en"
  type        = "string"
}

resource "davinci_connection" "my_awesome_flow_connector" {
  environment_id = var.environment_id

  name         = "Flow"
  connector_id = "flowConnector"
}

resource "davinci_flow" "my_awesome_subflow" {
  depends_on = [
    davinci_variable.my_awesome_language_variable,
  ]

  environment_id = var.environment_id

  name      = "My Awesome Subflow"
  flow_json = file("./path/to/example-subflow.json")

  connection_link {
    id                           = davinci_connection.my_awesome_flow_connector.id
    name                         = davinci_connection.my_awesome_flow_connector.name
    replace_import_connection_id = "33329a264e268ab31fb19637debf1ea3"
  }
}

resource "davinci_flow" "my_awesome_main_flow" {
  depends_on = [
    davinci_variable.my_awesome_region_variable,
    davinci_variable.my_awesome_language_variable,
  ]

  environment_id = var.environment_id

  name      = "My Awesome Main Flow"
  flow_json = file("./path/to/example-mainflow.json")

  subflow_link {
    id                        = resource.davinci_flow.my_awesome_subflow.id
    name                      = resource.davinci_flow.my_awesome_subflow.name
    replace_import_subflow_id = "07503fed5c02849dbbd5ee932da654b2"
  }

  connection_link {
    id                           = davinci_connection.my_awesome_flow_connector.id
    name                         = davinci_connection.my_awesome_flow_connector.name
    replace_import_connection_id = "33329a264e268ab31fb19637debf1ea3"
  }
}

resource "davinci_variable" "my_awesome_context_variable" {
  environment_id = var.environment_id

  context = "flow"
  flow_id = davinci_flow.my_awesome_main_flow.id

  name        = "userContextCode"
  description = "a flow variable used in the main flow"
  type        = "number"
  min         = "10"
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `environment_id` (String) The ID of the PingOne environment to import the DaVinci flow to.  Must be a valid PingOne resource ID.  This field is immutable and will trigger a replace plan if changed.
- `flow_json` (String, Sensitive) The DaVinci Flow to import, in raw JSON format. Should be a JSON file of a single flow (without subflows) that has been exported from a source DaVinci environment.  Must be a valid JSON string.

### Optional

- `connection_link` (Block Set) Mappings to connections that this flow depends on.  Connections should be managed (with the `davinci_connection` resource) or retrieved (with the `davinci_connection` data source) to provide the mappings needed for this configuration block. (see [below for nested schema](#nestedblock--connection_link))
- `deploy` (Boolean, Deprecated) **Deprecation notice:** This attribute is deprecated and will be removed in a future release.  Flows are automatically deployed on import. A boolean that specifies whether to deploy the flow after import.  Defaults to `true`.
- `description` (String) A string that specifies a description of the flow.  If the field is left undefined, the description from the flow export will be used.  If this field is left undefined and the flow export does not contain a description, the service will define a description on import.
- `name` (String) A string that identifies the flow name after import.  If the field is left blank, a flow name will be derived by the service from the name in the import JSON (the `flow_json` parameter).
- `subflow_link` (Block Set) Child flows of this resource, where the `flow_json` contains reference to subflows.  If the `flow_json` contains subflows, this one `subflow_link` block is required per contained subflow. (see [below for nested schema](#nestedblock--subflow_link))

### Read-Only

- `flow_configuration_json` (String, Sensitive) The parsed configuration of the DaVinci Flow import JSON.  Drift is calculated based on this attribute.
- `flow_export_json` (String, Sensitive) The DaVinci Flow export in raw JSON format following successful import, including target environment metadata.
- `flow_variables` (Attributes Set) List of Flow variables that will be updated in the DaVinci instance. These are variable resources that are created and managed by the Flow resource, where variables are embedded in the `flow_json` DaVinci export file. (see [below for nested schema](#nestedatt--flow_variables))
- `id` (String) The ID of this resource.

<a id="nestedblock--connection_link"></a>
### Nested Schema for `connection_link`

Required:

- `id` (String) A string that specifies the connector ID that will be applied when flow is imported.
- `name` (String) The connector name.  If `replace_import_connection_id` is also specified, this value is used when the flow is imported.  If `replace_import_connection_id` is not specified, the name must match that of the connector in the import file, so the connector ID in the `id` parameter can be updated.

Optional:

- `replace_import_connection_id` (String) Connection ID of the connector in the import to replace with the connector described in `id` and `name` parameters.  This can be found in the source system in the "Connectors" menu, but is also at the following path in the JSON file: `[enabledGraphData|graphData].elements.nodes.data.connectionId`.


<a id="nestedblock--subflow_link"></a>
### Nested Schema for `subflow_link`

Required:

- `id` (String) A string that specifies the subflow ID that will be applied when flow is imported.
- `name` (String) The subflow name.  If `replace_import_subflow_id` is also specified, this value is used when the flow is imported.  If `replace_import_subflow_id` is not specified, the name must match that of the connector in the import file, so the connector ID in the `id` parameter can be updated.

Optional:

- `replace_import_subflow_id` (String) Subflow ID of the subflow in the import to replace with the subflow described in `id` and `name` parameters.  This can be found in the source system in the "Connectors" menu, but is also at the following path in the JSON file: `[enabledGraphData|graphData].elements.nodes.data.connectionId`.


<a id="nestedatt--flow_variables"></a>
### Nested Schema for `flow_variables`

Read-Only:

- `context` (String) The variable context.  Should always return `flow`.
- `flow_id` (String) The flow ID that the variable belongs to, which should match the ID of this resource.
- `id` (String) The DaVinci internal ID of the variable.
- `name` (String) The user friendly name of the variable in the UI.
- `type` (String) The variable's data type.  Expected to be one of `string`, `number`, `boolean`, `object`.

## Import

Import is supported using the following syntax, where attributes in `<>` brackets are replaced with the relevant ID.  For example, `<environment_id>` should be replaced with the ID of the environment to import from.

```shell
$ terraform import davinci_flow.example <environment_id>/<davinci_flow_id>
```